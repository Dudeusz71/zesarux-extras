<HTML>
<HEAD>
<!-- META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=macintosh" -->
<TITLE>QL Service Manual</TITLE>
</HEAD>

<BODY BGCOLOR=#FFFFFF>

<table summary="Header navigation table" width=100% border=0 cellpadding=0 cellspacing=0>
<tr><th colspan=3>Sinclair QL Service Manual</th></tr>
<tr valign=bottom>
  <td width=10% align=left><a href="index.html">Previous</a></td>
  <td width=80% align=center></td>
  <td width=10% align=right><a href="qlsm2.html">Next</a></td>
</tr>
</table>
<hr>

<h1><a name="s1">SECTION 1</a><BR>SYSTEM DESCRIPTION</h1>

<h2>LIST OF CONTENTS</h2>
<ol>
<li><a href="#s1-p1">Introduction</a></li>
<li><a href="#s1-p2">Architecture</a></li>
<li><a href="#s1-p3">MC68008 CPU</a></li>
<li><a href="#s1-p4">Intel 8049 Intelligent Peripheral Controller (IPC)</a></li>
<li><a href="#s1-p5">Memory Organisation</a></li>
<li><a href="#s1-p6">Peripheral Control (ZX8301, ZX8302 and IC28)</a></li>
<li><a href="#s1-p7">Microdrive</a></li>
<li><a href="#s1-p8">Power Supplies</a></li>
<li><a href="#s1-p9">Test</a></li>
</ol>
<ul>
<li><a href="#s1-f1">RS232 Link</a></li>
<li><a href="#s1-f2">Keyboard Matrix Interconnections</a></li>
<li><a href="#s1-f3">QL Block Diagram</a></li>
<li><a href="#s1-f4">QL Circuit Diagram (Issue 5)</a></li>
<li><a href="#s1-f5">QL Circuit Diagram (Issue 6)</a></li>
</ul>

<h2><a name="s1-p1">1.</a> INTRODUCTION</h2>

<p><a name="s1-p1.1">1.1</a> The QL computer can be regarded in hardware terms as a combination of an enhanced Spectrum microcomputer, an Interface 1, an Interface 2 and two Microdrives within the same case. In practice the resemblance to the Spectrum is small, since the QL requires two microprocessors to accommodate powerful new software and is provided with 128k bytes of inbuilt DRAM. A block diagram of the Sinclair QL is given in Figure <a href="#s1-f3">1.3</a>.</p>

<p><a name="s1-p1.2">1.2</a> Two main versions of the QL are in circulation. A certain number of boards to build standards up to Issue 5 were issued in either ROM or EPROM versions with another ROM mounted pickaback in IC33 position. The second, volume production, version of the board to build standard Issue 6, and subsequent, features 48k of on-board ROM realised in two memory devices. In the following description the two versions are referred to as the pre-Issue 6 and the post-Issue 6 versions. The main differences between the two versions, as far as the circuit description is concerned, are that IC17 and IC27 have been deleted and IC38 added in the post-Issue 6 version.</p>

<h2><a name="s1-p2">2.</a> ARCHITECTURE</h2>

<p><a name="s1-p2.1">2.1</a> The architecture of the QL shown in Figure <a href="#s1-f3">1.3</a> incorporates much that is typical of microcomputer systems, but certain innovations make it atypical. Two microprocessors, an Intel 8049 and a Motorola 68008 are used, and the availability of 128k of DRAM plus a minimum of 200k on the two microdrives provides unusual storage facilities. The 8049 is designated the Intelligent Peripheral Controller (IPC) and the 68008 is the CPU. Two additional semi-custom ICs ZX8301 and ZX8302 control defined areas of the system, under the supervision of the CPU.</p>

<p><a name="s1-p2.2">2.2</a> The microcomputer electronics are housed on a single printed circuit board which also houses a regulated power supply fed from an external power unit. The keyboard forms part of the upper case assembly and is connected to the p.c. board via J11 and J12. The microdrive headboards and microdrive chassis, including the microdrives and the motors, form two complete sub-assemblies which plug in to the main p.c. board.</p>

<p><a name="s1-p2.3">2.3</a> To the rear and side of the case are plug assemblies which accommodate the following:
<ol type="a">
<li>main expansion connector, J1</li>
<li>ROM cartridge, J2</li>
<li>joystick, J3, J4</li>
<li>RS232, J5, J6</li>
<li>extra microdrives, EC1</li>
</ol></p>

<h2><a name="s1-p3">3.</a> MC68008 CPU</h2>

<p><a name="s1-p3.1">3.1</a> The Motorola MC68008 is a 32-bit microprocessor with an 8-bit data bus and is responsible for the overall timing and control of the QL. The firmware, which is outside the scope of this manual, resides in either a ROM or an EPROM depending on the version. The 68008 has an external clock, generated by the ZX8301 and has the usual bus input/output arrangement, viz. data bus, address bus and control bus. It operates semi-synchronously in this configuration.</p>

<p><a name="s1-p3.2">3.2</a> Data Bus. D0-D7 forms an 8-bit bi-directional data bus with active high, tri-state outputs. It is used for data exchanges with the memory, with the ZX8302 and ZX8301 and with the peripherals.</p>

<p><a name="s1-p3.3">3.3</a> Address Bus. Twenty bits A0-A19 are available for select and address purposes. A0-A15 form a 16-bit address bus with active high. The address bus provides the address for memory (up to 128k bytes) data exchanges and for data-exchanges with the QL and microdrive. Three bits A0, A1 and A5 are used for this latter purpose. Bits A16-A19 are used for device selection.</p>

<p><a name="s1-p3.4">3.4</a> Control Bus. The control bus is a collection of individual signals which supervise the flow of data on the address and data busses. The block diagram shows most of these signals but reference to the circuit diagram shows other control signals available at the expansion port. Control lines are summarised below.</p>

<p><a name="s1-p3.5">3.5</a> Interrupt Control (IPL0/2, IPL1). These inputs indicate the encoded priority level of the device requesting an interrupt, and are fed by IC24 (pins 23, 24) and IC23 (pin 26). A satisfactory interrupt condition must exist for two successive clocks before triggering an internal interrupt request. An interrupt acknowledge sequence is indicated by the function codes, FC0 and FC1. In this configuration FC0 and FC1 are NANDed together at IC27,6 and the output routed to the valid peripheral address (VPA) input to the CPU. This input indicates that the processor should use automatic vectoring for an interrupt. The IPL signals and VPA may also be input from an external device via J1, the main expansion connector.</p>

<p><a name="s1-p3.6">3.6</a> A16 and A17. These two address bits select ZX8301 and are decoded by it to assert the relevant CAS0 and CAS1 signal and ROMOEH and PCENL for the ZX8302 chip enable. For this purpose their states are either low and high, or high and low respectively. When ROM is being addressed both are in the low state.</p>

<p><a name="s1-p3.7">3.7</a> CLK Input. The CLK input denoted CLKCPU is the 7.5 MHz system clock from ZX8301. It is also fed to IC23 and IC24 and to the expansion port connector.</p>

<p><a name="s1-p3.8">3.8</a> Asynchronous data transfers are handled using the following control signals: DTACK, R/<span style="text-decoration: overline">W</span>, <span style="text-decoration: overline">DS</span> and <span style="text-decoration: overline">AS</span>. These signals are explained in the following paragraphs.</p>

<p><a name="s1-p3.9">3.9</a> DTACK (Data Transfer Acknowledge). This input indicates that the data transfer is completed, and is sent by the ZX8301 or through the expansion connector. When the processor recognises DTACK during a read cycle, data is latched and the bus cycle is terminated. When DTACK is recognised during a write cycle, the bus cycle is terminated.</p>

<p><a name="s1-p3.10">3.10</a> R/<span style="text-decoration: overline">W</span>. This tri-state signal defines the data bus transfer as a read or write cycle. The R/<span style="text-decoration: overline">W</span> signal also works in conjunction with the data strobe as explained in the following paragraph.</p>

<p><a name="s1-p3.11">3.11</a> <span style="text-decoration: overline">DS</span> (Data Strobe). This tri-state signal controls the flow of data on the data bus as shown in the table below. When the R/<span style="text-decoration: overline">W</span> line is high, the processor reads from the data bus as indicated. When the R/<span style="text-decoration: overline">W</span> line is low the processor writes to the data bus as shown.</p>
<center><table border>
<tr><th><span style="text-decoration: overline">DS</span></th><th>R/<span style="text-decoration: overline">W</span></th><th>D0-D7</th></tr>
<tr><td align=center>1</td><td align=center></td><td>No valid data</td></tr>
<tr><td align=center>0</td><td align=center>1</td><td>Valid Data Bits 0-7 (Read Cycle)</td></tr>
<tr><td align=center>0</td><td align=center>0</td><td>Valid Data Bits 0-7 (Write Cycle)</td></tr>
</table></center>
<p>If the CPU is addressing an external device with one of address bits A18 and A19 set, emitter follower TR8 is switched on by the signal KILLH from IC38. This sets the DSMCL (Data Strobe Master Chip - Active Low; the 'Master Chip' is the ZX8301) line permanently high thus disabling IC23 and IC22. The local <span style="text-decoration: overline">DS</span> signal is still enabled to J1, the expansion port, to control R/<span style="text-decoration: overline">W</span> operations from an external device. In the pre-Issue 6 version TR8 is switched from IC18.</p>

<p><a name="s1-p3.12">3.12</a> <span style="text-decoration: overline">AS</span> (Address Strobe). This tri-state signal indicates that there is a valid address on the address bus.</p>

<p><a name="s1-p3.13">3.13</a> Four other groups of control signals are used by the CPU. These four groups are routed to J1 only and are associated with Bus Arbitration Control, Peripheral Control, Processor Status and System Control in respect of external devices.</p>

<p><a name="s1-p3.14">3.14</a> Bus Arbitration Control. An explanation of this function is included for information only. It is not used by the QL but could be used by peripherals. The 68008 contains a simple 2-wire arbitration circuit designed to work with daisy-chained networks, priority encoded networks, or a combination of these techniques. This circuit is used in determining which device will be the bus master device. The BR (Bus Request) input is wire ORed with all other devices that could be bus masters. This device indicates to the processor that some other device desires to become the bus master. Bus requests may be used at any time in a cycle or even if no cycle is being performed. The BG (Bus Grant) output signal indicates to all other potential bus master devices that the processor will release bus control at the end of the current bus cycle.</p>

<p><a name="s1-p3.15">3.15</a> M6800-compatible Peripheral Control is exercised through the VPA and E output lines. VPA is derived from two processor status signals FC1 and FC0 as described above though this is only used for auto vectoring. E (Enable) is the standard enable signal common to all M6800 type peripheral devices. The period for this output is 10 MC68008 clock periods (six clocks low, four clocks high).</p>

<p><a name="s1-p3.16">3.16</a> Processor Status (FC0, FC1 and FC2) are function code outputs which indicate the state (user or supervisor) and the cycle type currently being executed, as shown in the table below. The information indicated by the function code outputs is valid whenever address strobe (<span style="text-decoration: overline">AS</span>) is active.<BR>
<center><table border>
<tr><th colspan=3>Function Code Output</th><th rowspan=2>Cycle Type</th></tr>
<tr><th>FC2</th><th>FC1</th><th>FC0</th></tr>
<tr><td align=center>LOW</td><td align=center>LOW</td><td align=center>LOW</td><td>(Undefined, Reserved)</td></tr>
<tr><td align=center>LOW</td><td align=center>LOW</td><td align=center>HIGH</td><td>User Data</td></tr>
<tr><td align=center>LOW</td><td align=center>HIGH</td><td align=center>LOW</td><td>User Program</td></tr>
<tr><td align=center>LOW</td><td align=center>HIGH</td><td align=center>HIGH</td><td>(Undefined, Reserved)</td></tr>
<tr><td align=center>HIGH</td><td align=center>LOW</td><td align=center>LOW</td><td>(Undefined, Reserved)</td></tr>
<tr><td align=center>HIGH</td><td align=center>LOW</td><td align=center>HIGH</td><td>Supervisor Data</td></tr>
<tr><td align=center>HIGH</td><td align=center>HIGH</td><td align=center>LOW</td><td>Supervisor Program</td></tr>
<tr><td align=center>HIGH</td><td align=center>HIGH</td><td align=center>HIGH</td><td>Interrupt Acknowledge</td></tr>
</table></center>

<p><a name="s1-p3.17">3.17</a> System Control inputs are used to either reset or halt the processor and to indicate to the processor that bus errors have occurred. There are three system control signals: BERR, HALT and RESET.</p>

<p><a name="s1-p3.18">3.18</a> BERR (Bus Error). Not used on the QL.</p>

<p><a name="s1-p3.19">3.19</a> RESET and HALT. The bidirectional RESET signal line acts to reset (start a system initialisation sequence) the processor in response to an external RESET signal. An internally generated reset (result of a reset instruction) causes all external devices to be reset and the internal state of the processor is not affected. A total system reset (processor and external devices) is the result of external HALT and RESET signals applied at the same time. HALT and RESET are tied together on the QL.</p>

<h2><a name="s1-p4">4.</a> INTEL 8049 INTELLIGENT PERIPHERAL CONTROLLER (IPC)</h2>

<p><a name="s1-p4.1">4.1</a> The 8049, IC24, is a totally self-sufficient 8-bit single chip microcomputer containing 2 k bytes of program memory and 128 bytes of RAM. It is clocked internally at 11 MHz from crystal X4.</p>

<p><a name="s1-p4.2">4.2</a> In this application the function of the 8049 is to:
<ol type="a">
<li>receive RS232 interface signals,</li>
<li>monitor the keyboard,</li>
<li>control the loudspeaker,</li>
<li>control the joystick.</li>
</ol>
The IPC utilises a data bus, two 8-bit I/O ports and some control lines to control these functions.</p>

<p><a name="s1-p4.3">4.3</a> Data Bus. DB0-DB7 constitutes an 8-bit bi-directional data bus with active high tri-state input/outputs. It is used only as input for scanning the keyboard and joysticks.</p>

<p><a name="s1-p4.4">4.4</a> Control Bus. Control is exercised by a number of discrete signals which organise the direction and flow of data between the 8049 and the ZX8302, and also communicate with, and monitor, other areas of the QL.</p>

<p><a name="s1-p4.5">4.5</a> Control Lines. The role of each control line is as follows:
<ol type="a">
<li>T1. Timer/Counter Input, 4 times the baud rate set by the user, controlled by a ZX8302 register.</li>
<li><span style="text-decoration: overline">WR</span>. Output strobe, active low, used as a read or write strobe to enable keyboard, joystick or RS232 data to IC23 over the P27 link line.</li>
<li>P10-P17. Output lines used to scan the keyboard and joysticks in conjunction with DB0-DB7.</li>
<li>P26. Not used on QL.</li>
<li>P21. Loudspeaker output.</li>
<li>P27. Serial link transmitting data to IC23.</li>
<li>P24, P25. RS232 handshake lines.</li>
<li>RESET. Input from IC23 used to initialise the 8049.</li>
<li>CLKCPU. Clock input from ZX8301.</li>
<li>P23, P22 (IPL1, IPL2). Interrupt request lines to 68008 CPU.</li>
<li>INT, P20. Interrupt input. INT initiates an interrupt on reception of RS232 first transition. P20 is used to read the data on the RS232 receive lines.</li>
</ol>

<p><a name="s1-p4.6">4.6</a> RS232 Link. IC24 is responsible for the receive side of the RS232 serial data link only, and IC23 the transmit side. Since, the RS232 link is best understood as an entity both aspects are discussed here.</p>

<p><a name="s1-p4.7">4.7</a> J5 and J6 are two RS232 connectors. J6 is connected so that the device connected to it may act as the Data Terminal Equipment (DTE) which originates the Data Terminal Ready (DTR) signal. J5 connects to the Data Communications Equipment (DCE) i.e. the local QL assumes DTE status. Figure <a href="#s1-f1">1.1</a> illustrates this schematically.</p>

<p><a name="s1-p4.8">4.8</a> The RS232 interface uses an 11-bit ASCII data frame, viz. one start bit, eight data bits and two stop bits comprise one character. Two stop bits are always sent but the interface receives compatibly with one except at 9600 baud, where one and a half stop bits are required. Data is transmitted asynchronously in the full duplex mode.</p>

<p><a name="s1-p4.9">4.9</a> Consider the QL as the DTE. Both DTE and DCE are switched on and have their DTR signals asserted. CTS and DTR (Clear to Send, Data Terminal Ready) do not form a handshake pair but are similar signals going in opposite directions. Serial data is transmitted by IC23 via driver IC25/6 and received by line receiver IC26/11. From IC26/11 data is fed to NAND gate IC27/9, pin 10 of which is set to the high state by the program, and input to IC24 pins 6 and 21 via IC27/11.</p>

<p align=center><a name="s1-f1"><img src="rs232link.png"></a><br>FIGURE 1.1 RS232 LINK</p>

<p><a name="s1-p4.10">4.10</a> On receipt of a start bit, IC24 is interrupted, and a subroutine clocks in the data bits, synchronised by the baud rate generator. The data, up to about 20 bytes per RS232 channel, is tnen buffered in IC24. At the same time, IC24 receives commands (and sends reports) via the serial link with IC18 which i-s controlled by IC23. When IC24 receives a command from IC18 to empty one of its buffers, it does so, down the serial link via IC23.</p>

<p><a name="s1-p4.11">4.11</a> With the QL acting as the DCE data and control is managed in a similar way utilising different IC25 and IC26 receivers/drivers.</p>

<p><a name="s1-p4.12">4.12</a> Keyboard Monitor. Under program control the 8049 systematically scans the keyboard, recording which keys have been pressed. Figure <a href="qlsm2.html#s2-f2">1.2</a> shows the way the keyboard is connected. It consists of an 8 x 8 matrix with one key, the shift key, connected to three input lines. The intersection of each row and column is bridged by a normally open contact. Pressing the key closes this switch. The row 'outputs' and column 'inputs' are shown connected to separate connectors J11 and J12, one to the port 1 outputs of IC24 and the other to the data bus inputs. Pull-down resistors R17 to R24 ensure that when none of the key-switches are closed row inputs KBO0 to KBO7 remain low.</p>

<p align=center><a name="s1-f2"><img src="keyboard.png"></a><br>FIGURE 1.2 KEYBOARD MATRIX INTERCONNECTIONS</p>

<p><a name="s1-p4.13">4.13</a> When the keyboard scanning routines are entered (KBOn is output, KBIn is input) the 8049 performs successive I/O read cycles setting each KBO0 to KBO7 line low in turn. At the same time the I/O port 1 inputs are scanned.</p>

<p><a name="s1-p4.14">4.14</a> There are a total of eleven diodes used for isolation. Eight of these, D4 through D11 are isolation diodes which isolate the different rows from each other. Three of the diodes D1 to D3 provide individual isolation for the Shift Control and Alt keys so that these keys have diodes in series with them in both directions of the matrix. They are thus fully isolated.</p>

<p><a name="s1-p4.15">4.15</a> Joystick. Connectors J3 and J4 provide a FIRE input and the four switch inputs for each of two joysticks. One line is not used. J3 and J4 are connected in parallel with keyboard connectors J11 and J12.</p>

<p><a name="s1-p4.16">4.16</a> Loudspeaker Operation. During the execution of a BEEP instruction the IPC writes to port 2, P21 thus switching on transistor TR1 and driving the loudspeaker. The loudspeaker is damped by resistor R104 (post-Issue 6 only).</p>

<h2><a name="s1-p5">5.</a> MEMORY ORGANISATION</h2>

<h3><a name="s1-p5.1">5.1</a> Introduction</h3>

<p><a name="s1-p5.1.1">5.1.1</a> The pre-Issue 6 version was supplied in both EPROM and ROM forms with on-board straps enabling the selection of ROM. Both versions have 48k of ROM and in both versions there are 128k bytes of RAM memory. Figure <a href="#s1-f3">1.3</a> shows how the memory is organised.</p>

<p><a name="s1-p5.1.2">5.1.2</a> The lower 48k bytes (addresses 0000-BFFF) are implemented in one 32k and one 16k byte ROM, IC33 and IC34 respectively which hold the monitor program. This program is a complex 68008 machine code program divided broadly into two parts: the operating system and the BASIC interpreter. Details of the program content are outside the scope of this manual.</p>

<p><a name="s1-p5.1.3">5.1.3</a> 32k bytes of memory (addresses C000-FFFF) have been left assigned to the ROM cartridge while 128k bytes of RAM (addresses 20000-3FFFF) are implemented on sixteen 64k-bit dynamic RAMs, IC1-IC16.</p>

<h3><a name="s1-p5.2">5.2</a> Read/Write Operations</h3>

<p>The following description should be read in conjunction with the circuit diagrams given in Figures <a href="#s1-f4">1.4</a> (pre-Issue 6) and <a href="#s1-f5">1.5</a> (post-Issue 6).</p>

<p><a name="s1-p5.2.1">5.2.1</a> Read Only Memory. The CPU addresses the ROM/EPROM directly during memory read cycles using the address bus A15-A0. In the pre-Issue 6 version, depending on the ROM/EPROM fit, the enabling and selection pins on IC33 and IC34 are set by link selection on IC17. Links JU1 to JU6 via gate circuit IC17 are used to provide the correct signals; the link fit requirements for different ROM/EPROM versions is listed on the circuit diagram, Figure <a href="#s1-f4">1.4</a>. In the post-Issue 6 version the ROMs are enabled directly by the signal ROMOEH from ZX8301.</p>

<p><a name="s1-p5.2.2">5.2.2</a> RAM Memory (IC1-IC16). The sixteen RAM ICs making up the 16k x 64 bit RAM memory are organised as two matrices of 256 rows x 256 columns i.e. IC1-8 and IC9-16. Thus, separate 8-bit row and column addresses are required to access any one of the 64k locations in each section. These addresses are supplied by the CPU (68008) on address bus A0 to A15 via tri-state address multiplexers IC19 and IC20. These multiplexers decode from sixteen to eight lines and outputs enabled by the row address select line (RASL) signal from the ZX8301. The valid data address (VDA) selects the address from the CPU (via multiplexers IC19, IC20) or from the ZX8301. ROWL from the ZX8301 selects the row/column address. The R/W signal from the CPU informs the ZX8301 to expect either a read or a write cycle. For a write cycle the ZX8301 enables the write enable (WEL) line to the memory.</p>

<p><a name="s1-p5.2.3">5.2.3</a> The eight bits each of column and row address are routed to both 64k sections of the RAM but the signals 'column address select 0' (CAS0L) and 'column address select 1' (CAS1L) from the ZX8301 ensure that only the required half of the memory is active. Address bits A16 and A17 from the CPU are decoded by the ZX8301 to enable the relevant CAS signal. The row address select line (RASL) signal from the ZX8301 is enabled during all read and write cycles from RAM.</p>

<p><a name="s1-p5.2.4">5.2.4</a> The ZX8301 has priority when accessing memory since it must access the memory mapped display area in the RAM at set intervals in order to build up the video for the TV display. When the ZX8301 requires to access memory, it asserts the VDA signal to CPU address multiplexers IC19, IC20 and addresses RAM directly via its own address bus on pins 13, 17, 18, 20, 22, 24, 27 and 28.</p>

<p><a name="s1-p5.2.5">5.2.5</a> Isolation between the two data busses D0-D7 and DB0-DB7 is accomplished using bus transceiver IC21. During ZX8301 memory cycles IC21 is disabled by negating the signal DEL from Hard Array Logic (HAL) IC38. This signal is controlled by ZX8301 signal TXOEL. In the pre-Issue 6 version, which does not incorporate the HAL, TXOEL is fed directly to IC21.</p>

<p><a name="s1-p5.2.6">5.2.6</a> Refresh for the DRAM memory is accomplished during normal read cycles i.e. most rows are refreshed each time the ZX8301 accesses the memory mapped display area during picture compilation, the remaining rows are refreshed as a result of other read cycles also known to occur at regular intervals within the refresh period.</p>

<h2><a name="s1-p6">6.</a> PERIPHERAL CONTROL (ZX8301, ZX8302, IC38 and IC28)</h2>

<h3><a name="s1-p6.1">6.1</a> ZX8301, IC22.</h3><p>The ZX8301 carries out the following functions:
<ol type="a">
<li>TV picture generation</li>
<li>master clock generation</li>
<li>system address decode</li>
<li>DRAM refresh</li>
<li>control of the bus transceiver.</li>
</ol></p>

<p><a name="s1-p6.1.1">6.1.1</a> The TV picture generation section of IC22 operates in conjunction with the memory mapped picture display area to produce five colour TV signals suitable for driving a colour monitor. These signals, red, green and blue (RGB), CSYNCL (composite sync) and VSYNCH (vertical sync) are routed to connector J7. The RGB and CSYNCL signals are also input to IC28 which produces composite PAL to drive a domestic TV receiver. The same signals are mixed in transistor TR9 to produce a composite video signal to drive a standard monochrome monitor. VSYNCH is also routed to IC23 where it is used to provide an interrupt at the frame rate. This is used to give a time reference to the job scheduling supervisor in the operating system.</p>

<p><a name="s1-p6.1.2">6.1.2</a> Using the 15 MHz crystal clock, X1, IC22 derives line and field timing compatible with the external receiver. Video is derived by accessing the memory mapped display area in the RAM in a set sequence at set times throughout the picture frame. The addresses are necessarily independent of the CPU and appear on IC22 address lines DA0 through DA7.</p>

<p><a name="s1-p6.1.3">6.1.3</a> The net result is the five video signals output from IC22 on pins 32, 31, 30, 12 and 11.</p>

<p><a name="s1-p6.1.4">6.1.4</a> The RGB signals are fed to level-setting resistor divider network R48-R53 and a.c. coupled to RGB-to-PAL converter IC28 on pins 3, 4 and 5. The composite sync signal CSYNC is input on pin 2. External components of the circuit provide a number of clamp circuits; the luminance and chrominance signals are fed out, filtered and fed back in; the chrominance 4.43 crystal oscillator is connected; and a CR lead/lag network introduces a 90&deg; phase shift. The crystal has a very high tolerance and does not need trimming.</p>

<p><a name="s1-p6.1.5">6.1.5</a> The composite PAL signal is output on pin 9, divided down and applied to an encapsulated UHF modulator M1.</p>

<p><a name="s1-p6.1.6">6.1.6</a> Master clock is divided by two in IC22 from the externally connected 15 MHz crystal X1 and distributed via output pin 7 to various destinations on the board, and to J1 the main expansion connector.</p>

<p><a name="s1-p6.1.7">6.1.7</a> The system address decode signal PCENL, routed to peripheral controller ZX8302 pin 10, is derived differently on the two board versions. On the pre-Issue 6 board it is output from ZX8301 pin 39 and is derived from a combination of one of the decodes from address lines A16 and A17, and A14 (via DA6). In the post-Issue 6 version it is output from HAL pin 17 and is derived in a similar way from a decode of address lines A16, A17 and A6.</p>

<h3><a name="s1-p6.2">6.2</a> ZX8302, IC23.</h3><p>The ZX8302 is termed the peripheral chip since it controls all signals to and from the peripheral devices. Signals to/from the following are supervised:
<center><table border>
<tr><td>Keyboard</td><td rowspan=4>by serial link to IPC</td></tr>
<tr><td>Speaker</td></tr>
<tr><td>Joystick</td></tr>
<tr><td>RS232 (half)</td></tr>
<tr><td>RS232 (half)</td></tr>
<tr><td>Net</td></tr>
<tr><td>Microdrive</td></tr>
<tr><td>Real-Time clock</td></tr>
<tr><td>Interrupt control</td></tr>
</table></center></p>

<p><a name="s1-p6.2.1">6.2.1</a> IC23, in common with IC24, works autonomously and is polled by the CPU. It has its own 32 kHz crystal clock X2 and has an external interrupt input on pin 2 from J1, the expansion connector. Switch S3 connected to pin 21 resets the device when operated. Pin 28 output resets the CPU and IPC.</p>

<p><a name="s1-p6.2.2">6.2.2</a> Address lines A0, A1 and A5 from the CPU select the specific device requiring service viz: one of (a) to (e) in paragraph <a href="#s1-p5.2">5.2</a> above. The VSYNCH and PCENL signals input on pins 10 and 32 have been discussed in paragraph <a href="#s1-p6.1.1">6.1.1</a> and <a href="#s1-p6.1.7">6.1.7</a> respectively. The DSMCL signal is discussed in paragraph <a href="#s1-p3.11">3.11</a>.</p>

<p><a name="s1-p6.2.3">6.2.3</a> Serial data from the various devices is converted to parallel data in IC23 and output to the data bus as DB0-DB7. Parallel data from the bus is converted to serial data and routed to the relevant device for transmission.</p>

<p><a name="s1-p6.2.4">6.2.4</a> The RS232 serial link, the keyboard and the joystick operation have already been discussed in the 8049&micro;C (IC24) section.</p>

<p><a name="s1-p6.2.5">6.2.5</a> The two Net jack plugs J9 and J10 are connected in the same way as in the Spectrum Interface 1 circuit. The network is common emitter in that all stations on the network can either source current into the net or be turned off, i.e. be set in tri-state. Jack plugs are used such that those sockets which are unused serve to terminate the network.</p>

<p><a name="s1-p6.2.6">6.2.6</a> When a jack is inserted in the socket it opens up a connection to a 330&Omega; resistor, R15 or R16, disconnecting it from the circuit. With a network set up, the two end stations would be the only ones with the 330&Omega; resistors in circuit. There is therefore their combined resistance, giving a pull-down impedance of about 165&Omega; to the circuit. IC23 contains the interface and control circuitry for the network.</p>

<p><a name="s1-p6.2.7">6.2.7</a> The real-time clock is run from the 32 kHz crystal X2 on pins 31 and 30. Date and time are resettable under software control. On pre-Issue 6 QLs, a trimming capacitor TC1 enabled trimming of the oscillator frequency. On the post-Issue 6 the trimming capacitor has been replaced by a fixed capacitor.</p>

<p><a name="s1-p6.2.8">6.2.8</a> The remaining lines out from IC23 are the microdrive control and data lines on pins 3, 1, 19, 21, 33 and 34. These inputs and outputs are discussed in Section <a href="#s1-p7">7</a>, MICRODRIVE.</p>

<h2><a name="s1-p7">7.</a> MICRODRIVE</h2>

<h3><a name="s1-p7.1">7.1</a> Introduction</h3>

<p><a name="s1-p7.1.1">7.1.1</a> Microdrive organisation and control in the QL is similar to that found in the Spectrum, bearing in mind that the two QL microdrives are integrated into the system and that Interface 1 functions are all executed by IC23; also the frequency is different and write protect is different.</p>

<p><a name="s1-p7.1.2">7.1.2</a> Additional microdrives may be connected to the system via connector EC1.</p>

<p><a name="s1-p7.1.3">7.1.3</a> Only one microdrive may be in use at any instant. The required microdrive and the type of operation, read or write, is selected under software control. During a read operation data is read from the selected microdrive tape. During a write operation the microdrive tape is erased before being written. The erase head is displaced from the write head and is timed by IC23 to sink current before the write head is enabled.</p>

<h3><a name="s1-p7.2">7.2</a> Microdrive Selection</h3>

<p><a name="s1-p7.2.1">7.2.1</a> Microdrives are selected using the MDSELDH and MDSELCKN signals from IC23. Each microdrive control chip, IC29 and IC30, contain one stage of a shift register, realised by a flip-flop. MDSELCKN is connected to each microdrive and MDSELDH is routed to pin 22 (COMMS IN) of IC29, which is the input to the shift register. The shift register output on pin 20 (COMMS OUT) is routed to COMMS IN in IC30. COMMS OUT on IC30 pin 20 is routed to microdrive expansion connector EC1. The selected microdrive has a '1' on its COMMS OUT pin. Thus the required microdrive is selected by shifting the '1' accordingly.</p>

<p><a name="s1-p7.2.2">7.2.2</a> COMMS OUT not only feeds the next microdrive; it is used to select its own chip internal functions and to select the LED, the motor, and the erase current for the selected microdrive. Therefore while this signal is low the motor is disabled, the LED is off, no current can flow through the microdrive switch (S1 or S2), and no erase current can flow.</p>

<p><a name="s1-p7.2.3">7.2.3</a> Consider the motor drive circuit for number 1 motor. A high on pin 20 of IC29 turns on TR4. This pulls the base of TR6 low, turning it on and switching power to motor 1. Capacitor C21 and resistor R28 time constant ensures that the motor does not cut out too quickly and damage the tape. The red LED D20 is switched on at the same time. With TR6 turned on and write protect switch S1 closed the erase head current circuit is enabled via pin 6 of headboard 1 connector. When the erase output is enabled on pin 1 of IC23, transistor TR3 switches on and current flows in the selected microdrive erase head. Diodes D18 and D16 provide protection against reverse currents. Diodes D12 across the erase head and D15 perform similar functions. The amount of current flowing in the erase head is limited by R25.</p>

<p><a name="s1-p7.2.4">7.2.4</a> Write protection is achieved by the action of the microswitch on the microdrive chassis. The switch is operated by the write protect tab on the microdrive cartridge. When the tab is present the select supply line is connected to the erase coil, enabling the QL to write normally. When the tab is absent, the supply to the erase head is disconnected, and the MDRDWL line is held high (read mode) via R100/101 and D22/23 (see Section 5, para <a href="qlsm5.html#s5-p3.1">3.1</a>). This line is clamped to 5 volts maximum by diode D29. The purpose of D22/23 is to prevent unselected microdrives with no cartridge inserted (or with writeprotected cartridge inserted) from loading the MDRDWL line.</p>

<h3><a name="s1-p7.3">7.3</a> Read/Write Operations</h3>

<p><a name="s1-p7.3.1">7.3.1</a> The MDRDWL signal on IC23 pin 3 places the selected microdrive in either the read or the write mode, and enables the read or the write amplifiers.</p>

<p><a name="s1-p7.3.2">7.3.2</a> Data is recorded on two tracks using a standard stereo cassette head arrangement and is written in bytes, one byte to one track and the next byte to the other track. It is recovered in the same way. The tape itself is one continuous loop. Since hardware takes care of switching between tracks the software sees the tape as one doublelength single track.</p>

<p><a name="s1-p7.3.3">7.3.3</a> Power to the microdrive circuits has to be filtered and IC31 and capacitors C9 and C11 are used to accomplish this. IC31 is the regulator.</p>

<p><a name="s1-p7.3.4">7.3.4</a> Read Cycle. Consider IC29 and headboard 1. In the read mode the signals appearing in the two read coils inside the heads are differentially amplified through two amplifier chains within IC29. The signals are then converted to digital form to enable logic processing. The outputs from the two amplifiers, in digital form are enabled into the DATA 1 and DATA 2 outputs from IC29 on pins 24 and 19. These signals are routed to the interface within IC23 via RAH (Read and Write) 1 and 2, pins 21 and 19.</p>

<p><a name="s1-p7.3.5">7.3.5</a> The signal recorded on magnetic tape is at the greatest when the rate of change of the signal imposing it is at its fastest. Therefore when a squarewave has been written, the greatest recovered voltage is obtained on the edge of the pulse. Since the object of the exercise is to produce a waveform which changes at the peaks of the recovered signal, IC29 contains amplifiers to bring the signal up to the required level, and a peak detect circuit which changes state when the input reaches its greatest level. The peak detector is followed by a hysteresis circuit which ensures that the output does not change on spurious signals.</p>

<p><a name="s1-p7.3.6">7.3.6</a> The gain of the circuit should not need to be changed, as only one type of high quality video tape is used. The reproduced signal levels may be read across capacitors C15 and C17 and are typically in the order of 400 to 500 mV and 250 to 350 mV for the low frequency and high frequency signals respectively. In the record mode the modulator in IC23 converts the ones and zeros in the data into FM (frequency modulation) where there is always a transition at the beginning of the bit cell. If the data is a one there is a transition at the beginning and in the middle of the bit cell, which means essentially that the frequency doubles if the data contains ones. Hence high and low frequencies at C15 and C17.</p>

<p><a name="s1-p7.3.7">7.3.7</a> Write Cycle. When the MDRDWL signal from IC23 goes low the selected microdrive is placed in the write mode. This has the effect of changing DATA 1 and DATA 2 on IC29 from outputs to inputs. These inputs are used to drive current sources for track 1 and track 2. When DATA 1 is high for example, current is pulled in one direction through the head, when it is low current is pulled in the other direction.</p>

<h2><a name="s1-p8">8.</a> POWER SUPPLIES</h2>

<p><a name="s1-p8.1">8.1</a> A custom-built power pack, external to the main board, supplies 9 volts d.c. at 2 amps and 44 volts peak-to-peak a.c. to the board input on connector J3. The power pack uses a thyristor to limit peak voltages on the d.c., but is otherwise unregulated and has significant ripple.</p>

<p><a name="s1-p8.2">8.2</a> The a.c. input is applied to two rectifiers IC37 and IC36 to produce +12 volts at 80 milliamps and -12 volts at 50 milliamps, respectively.</p>

<p><a name="s1-p8.3">8.3</a> The d.c. input is regulated down to +5 volts by regulator IC35.</p>

<p><a name="s1-p8.4">8.4</a> All three supplies are completely protected in that the regulators are equipped with thermal and short circuit shutdown.</p>

<h2><a name="s1-p9">9.</a> TEST</h2>

<p><a name="s1-p9.1">9.1</a> A good simple test of the equipment may be carried out by connecting a loopback cable to the RS232 interface connectors J5 and J6 and instructing them to talk to each other. The technique for receiving RS232 involves the data passing through the IPC, through ZX8302 and back onto the processor data bus. If this functions correctly it is close to a guarantee that the whole system is functional.</p>

<p><a name="s1-p9.2">9.2</a> A test tape is available which exercises most of the functions of the QL and is a useful initial diagnostic tool. See <a href="qlsm3.html#s3">Section 3</a> for details.</p>

<p align=center><a name="s1-f3"><a href="QLBlockDiagram.gif"><img src="bldiag.gif"></a></a><br>FIGURE 1.3 QL BLOCK DIAGRAM</p>

<p align=center><a name="s1-f4"><a href="QLSchematicIssue5.gif"><img src="circuit5.gif"></a></a><br>FIGURE 1.4 QL CIRCUIT DIAGRAM (Issue 5)</p>

<p align=center><a name="s1-f5"><a href="QLSchematicIssue6.gif"><img src="circuit6.gif"></a></a><br>FIGURE 1.5 QL CIRCUIT DIAGRAM (Issue 6)</p>

<hr>
<table summary="Footer navigation table" width=100% border=0 cellpadding=0 cellspacing=0>
  <tr valign=top>
    <td width=40% align=left><a href="index.html">Previous</a></td>
    <td width=20% align=center><a href="index.html">Contents</a></td>
    <td width=40% align=right><a href="qlsm2.html">Next</a></td>
  </tr>
  <tr valign=top>
    <td width=40% align=left>Contents</td>
    <td width=20% align=center>&nbsp;</td>
    <td width=40% align=right>Disassembly/Assembly</td>
  </tr>
</table>

</BODY>
</HTML>
